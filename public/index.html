<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Vampir KÃ¶ylÃ¼ 2D: Voice</title>
    <style>
        body { background: #1a1c2c; color: white; font-family: 'Segoe UI', sans-serif; transition: 1.5s; text-align: center; margin: 0; }
        .night-mode { background: #070914; }
        #container { max-width: 500px; margin: auto; padding: 20px; }
        
        /* 2D Kart TasarÄ±mÄ± Geri Geldi */
        .player-card {
            background: #2f357d; border-radius: 12px; padding: 15px; margin: 10px 0;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); animation: slideIn 0.4s;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        
        .dead { filter: grayscale(1) opacity(0.5); border: 2px solid #ff4b5c; }
        
        button { border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-action { background: #ff4b5c; color: white; }
        .btn-vote { background: #f9d423; color: #1a1c2c; }
        .btn-mic { background: #4ecca3; margin-bottom: 10px; width: 100%; font-size: 1.1rem; }
        
        #status-bar { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px dashed #4ecca3; }
        #role-tag { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; display: block; }
    </style>
</head>
<body id="bg">
    <div id="container">
        <h1>ğŸ§›â€â™‚ï¸ Vampir KÃ¶ylÃ¼ 2D</h1>
        
        <div id="setup">
            <input type="text" id="nameInp" placeholder="AdÄ±n ne?" style="padding: 10px; border-radius: 5px;">
            <button style="background:#4ecca3" onclick="join()">KatÄ±l</button>
        </div>

        <div id="game-ui" style="display:none;">
            <button class="btn-mic" onclick="toggleMic()" id="mic-btn">ğŸ¤ Mikrofonu AÃ§</button>
            <span id="role-tag"></span>
            <div id="status-bar">Lobi bekleniyor...</div>
            <div id="player-list"></div>
            <br>
            <button id="start-btn" style="background:#4ecca3; width:100%" onclick="start()">Oyunu BaÅŸlat</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = "";

        async function toggleMic() {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                document.getElementById('mic-btn').innerText = "ğŸ¤ Mikrofon AÃ§Ä±k";
                document.getElementById('mic-btn').style.background = "#00d2ff";
            } catch (e) { alert("Mikrofon izni gerekli!"); }
        }

        function join() {
            const n = document.getElementById('nameInp').value;
            if(n) {
                socket.emit('joinGame', n);
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game-ui').style.display = 'block';
            }
        }

        function start() { socket.emit('startGame'); }

        socket.on('assignRole', (role) => {
            myRole = role;
            const tag = document.getElementById('role-tag');
            tag.innerText = "ROLÃœN: " + role;
            tag.style.color = role === 'Vampir' ? '#ff4b5c' : '#4ecca3';
            document.getElementById('start-btn').style.display = 'none';
        });

        socket.on('gameUpdate', (data) => {
            document.getElementById('bg').className = data.state === 'night' ? 'night-mode' : '';
            document.getElementById('status-bar').innerText = data.message;
            const list = document.getElementById('player-list');
            list.innerHTML = "";

            data.players.forEach(p => {
                const card = document.createElement('div');
                card.className = `player-card ${p.alive ? '' : 'dead'}`;
                card.innerHTML = `<span>${p.name} ${p.alive ? 'ğŸ‘¤' : 'ğŸ’€'}</span>`;
                
                if (p.alive && p.id !== socket.id) {
                    const btn = document.createElement('button');
                    if (data.state === "night" && myRole === "Vampir") {
                        btn.innerText = "SaldÄ±r"; btn.className = "btn-action";
                        btn.onclick = () => socket.emit('vampireAction', p.id);
                        card.appendChild(btn);
                    } else if (data.state === "night" && myRole === "Doktor") {
                        btn.innerText = "Koru"; btn.className = "btn-action";
                        btn.style.background = "#00d2ff";
                        btn.onclick = () => socket.emit('doctorAction', p.id);
                        card.appendChild(btn);
                    } else if (data.state === "day") {
                        btn.innerText = "Oyla"; btn.className = "btn-vote";
                        btn.onclick = () => socket.emit('castVote', p.id);
                        card.appendChild(btn);
                    }
                }
                list.appendChild(card);
            });
        });

        socket.on('announcement', (m) => alert(m));
        socket.on('updatePlayerList', (players) => {
            if(!myRole) {
                document.getElementById('player-list').innerHTML = players.map(p => 
                    `<div class="player-card"><span>${p.name} ğŸ‘¤</span></div>`).join('');
            }
        });
    </script>
</body>
</html>