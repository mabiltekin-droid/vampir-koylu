<!DOCTYPE html>
<html>
<head>
    <title>Vampir K√∂yl√º: Voice Edition</title>
    <style>
        body { background: #1a1c2c; color: white; font-family: sans-serif; text-align: center; }
        .player-card { background: #2f357d; border-radius: 10px; padding: 15px; margin: 10px; display: flex; justify-content: space-between; }
        .night { background: #070914; }
        .dead { opacity: 0.5; filter: grayscale(1); }
        button { cursor: pointer; padding: 8px; border-radius: 5px; border: none; font-weight: bold; }
        #voice-btn { background: #ff4b5c; margin-bottom: 10px; }
    </style>
</head>
<body id="bg">
    <h1>üßõ‚Äç‚ôÇÔ∏è Vampir K√∂yl√º Voice</h1>
    
    <div id="setup">
        <input type="text" id="nameInp" placeholder="Adƒ±n...">
        <button onclick="join()">Katƒ±l</button>
    </div>

    <div id="game-ui" style="display:none;">
        <button id="voice-btn" onclick="toggleMic()">üé§ Mikrofonu A√ß</button>
        <div id="role-tag"></div>
        <div id="status-bar">Lobi...</div>
        <div id="player-list"></div>
        <button id="start-btn" onclick="start()">Oyunu Ba≈ülat</button>
    </div>

    <div id="audio-container"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = "";
        let stream;

        async function toggleMic() {
            try {
                if (!stream) {
                    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    document.getElementById('voice-btn').innerText = "üé§ Mikrofon A√ßƒ±k";
                    document.getElementById('voice-btn').style.background = "#4ecca3";
                    // Burada normalde WebRTC sinyalle≈ümesi gerekir, 
                    // ≈üimdilik mikrofon izni aldƒ±ƒüƒ±mƒ±zƒ± varsayƒ±yoruz.
                }
            } catch (err) { alert("Mikrofon izni reddedildi!"); }
        }

        function join() {
            const n = document.getElementById('nameInp').value;
            if(n) {
                socket.emit('joinGame', n);
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game-ui').style.display = 'block';
            }
        }

        function start() { socket.emit('startGame'); }

        socket.on('assignRole', (role) => {
            myRole = role;
            document.getElementById('role-tag').innerText = "ROL√úN: " + role;
            document.getElementById('start-btn').style.display = 'none';
        });

        socket.on('gameUpdate', (data) => {
            document.getElementById('bg').className = data.state === 'night' ? 'night' : '';
            document.getElementById('status-bar').innerText = data.message;
            const list = document.getElementById('player-list');
            list.innerHTML = "";

            data.players.forEach(p => {
                const card = document.createElement('div');
                card.className = `player-card ${p.alive ? '' : 'dead'}`;
                card.innerHTML = `<span>${p.name}</span>`;
                
                if (p.alive && p.id !== socket.id) {
                    const btn = document.createElement('button');
                    if (data.state === "night" && myRole === "Vampir") {
                        btn.innerText = "Saldƒ±r";
                        btn.onclick = () => socket.emit('vampireAction', p.id);
                        card.appendChild(btn);
                    } else if (data.state === "day") {
                        btn.innerText = "Oyla";
                        btn.onclick = () => socket.emit('castVote', p.id);
                        card.appendChild(btn);
                    }
                }
                list.appendChild(card);
            });
        });

        socket.on('announcement', (m) => alert(m));
    </script>
</body>
</html>