<!DOCTYPE html>
<html>
<head>
    <title>Vampir KÃ¶ylÃ¼ Online</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        #game-box { margin-top: 30px; border: 2px solid #333; padding: 20px; display: inline-block; border-radius: 15px; background: #1e1e1e; min-width: 300px; }
        .vampire { color: #ff4d4d; font-weight: bold; text-shadow: 0 0 10px rgba(255,0,0,0.5); }
        ul { list-style: none; padding: 0; }
        li { background: #2a2a2a; margin: 10px 0; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        button { cursor: pointer; padding: 8px 15px; border-radius: 5px; border: none; background: #4a90e2; color: white; font-weight: bold; }
        button:hover { background: #357abd; }
        .action-btn { background: #e94b3c; margin-left: 10px; }
        #status { font-style: italic; color: #bbb; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ§›â€â™‚ï¸ Vampir KÃ¶ylÃ¼</h1>
    
    <div id="setup">
        <input type="text" id="username" placeholder="AdÄ±n ne?" style="padding: 10px; border-radius: 5px; border: none;">
        <button onclick="join()">KatÄ±l</button>
    </div>

    <div id="game-box" style="display:none;">
        <h2 id="role-display">Lobi Bekleniyor...</h2>
        <p id="status">OyuncularÄ±n toplanmasÄ± bekleniyor...</p>
        
        <ul id="player-list"></ul>
        
        <br>
        <button id="start-btn" onclick="start()">Oyunu BaÅŸlat</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myId = "";
        let myRole = "";

        socket.on('connect', () => {
            myId = socket.id;
        });

        function join() {
            const name = document.getElementById('username').value;
            if(name) {
                socket.emit('joinGame', name);
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game-box').style.display = 'block';
            }
        }

        function start() {
            socket.emit('startGame');
        }

        // Rol AtandÄ±ÄŸÄ±nda
        socket.on('assignRole', (role) => {
            myRole = role;
            const el = document.getElementById('role-display');
            el.innerText = "RolÃ¼n: " + role;
            if(role === 'Vampir') el.className = 'vampire';
            document.getElementById('start-btn').style.display = 'none';
        });

        // Liste GÃ¼ncellendiÄŸinde (Lobi ve CanlÄ±/Ã–lÃ¼ Takibi)
        socket.on('updatePlayerList', (players) => {
            const list = document.getElementById('player-list');
            list.innerHTML = players.map(p => `<li>${p.name} ${p.alive ? 'âœ…' : 'ğŸ’€'}</li>`).join('');
        });

        // Oyunun Gece/GÃ¼ndÃ¼z DÃ¶ngÃ¼sÃ¼ ve Butonlar
        socket.on('gameUpdate', (data) => {
            document.getElementById('status').innerText = data.message;
            const list = document.getElementById('player-list');
            list.innerHTML = "";

            data.players.forEach(p => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${p.name} ${p.alive ? 'âœ…' : 'ğŸ’€'}</span>`;
                
                // EÄŸer ben hayattaysam ve hedef oyuncu hayattaysa buton ekle
                const me = data.players.find(player => player.id === socket.id);
                
                if (me && me.alive && p.alive && p.id !== socket.id) {
                    const btn = document.createElement('button');
                    btn.className = "action-btn";

                    if (data.state === "night" && myRole === "Vampir") {
                        btn.innerText = "Kurban SeÃ§";
                        btn.onclick = () => socket.emit('vampireAction', p.id);
                        li.appendChild(btn);
                    } else if (data.state === "day") {
                        btn.innerText = "Oyla";
                        btn.style.background = "#f39c12";
                        btn.onclick = () => socket.emit('castVote', p.id);
                        li.appendChild(btn);
                    }
                }
                list.appendChild(li);
            });
        });

        // Ã–nemli Duyurular (AsÄ±ldÄ±, KazandÄ± vs.)
        socket.on('announcement', (msg) => {
            alert(msg);
        });
    </script>
</body>
</html>