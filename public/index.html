<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Vampir K√∂yl√º: 2D Edition</title>
    <style>
        body { background: #1a1c2c; color: white; font-family: 'Segoe UI', sans-serif; transition: background 1.5s; text-align: center; margin: 0; }
        .night { background: #070914; }
        #game-container { max-width: 600px; margin: 40px auto; padding: 20px; }
        
        /* 2D Kart Tasarƒ±mƒ± */
        .player-card {
            background: #2f357d; border-radius: 15px; padding: 15px; margin: 10px 0;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.3s;
            animation: slideIn 0.5s ease-out;
        }
        .player-card:hover { transform: scale(1.03); }
        .dead { filter: grayscale(1); opacity: 0.6; animation: shake 0.4s; border: 2px solid red; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes shake { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(3deg); } 75% { transform: rotate(-3deg); } }

        /* Butonlar */
        button { border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-join { background: #4ecca3; color: #1a1c2c; }
        .btn-kill { background: #ff4b5c; color: white; }
        .btn-heal { background: #00d2ff; color: white; }
        .btn-vote { background: #f9d423; color: #333; }

        #status-bar { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; font-style: italic; }
        #role-tag { font-size: 1.5rem; text-transform: uppercase; margin-bottom: 10px; display: block; }
    </style>
</head>
<body id="bg">
    <div id="game-container">
        <h1>üßõ‚Äç‚ôÇÔ∏è Vampir K√∂yl√º 2D</h1>
        
        <div id="setup">
            <input type="text" id="nameInp" placeholder="Adƒ±nƒ± yaz..." style="padding: 10px; border-radius: 5px;">
            <button class="btn-join" onclick="join()">Katƒ±l</button>
        </div>

        <div id="game-ui" style="display:none;">
            <span id="role-tag">Rol√ºn Belirleniyor...</span>
            <div id="status-bar">Lobi bekleniyor...</div>
            <div id="player-list"></div>
            <br>
            <button id="start-btn" class="btn-join" onclick="start()">Oyunu Ba≈ülat</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = "";

        function join() {
            const n = document.getElementById('nameInp').value;
            if(n) {
                socket.emit('joinGame', n);
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game-ui').style.display = 'block';
            }
        }

        function start() { socket.emit('startGame'); }

        socket.on('assignRole', (role) => {
            myRole = role;
            const tag = document.getElementById('role-tag');
            tag.innerText = "Rol√ºn: " + role;
            tag.style.color = role === 'Vampir' ? '#ff4b5c' : (role === 'Doktor' ? '#00d2ff' : '#4ecca3');
            document.getElementById('start-btn').style.display = 'none';
        });

        socket.on('gameUpdate', (data) => {
            document.getElementById('bg').className = data.state === 'night' ? 'night' : '';
            document.getElementById('status-bar').innerText = data.message;
            
            const list = document.getElementById('player-list');
            list.innerHTML = "";

            data.players.forEach(p => {
                const card = document.createElement('div');
                card.className = `player-card ${p.alive ? '' : 'dead'}`;
                card.innerHTML = `<span>${p.name} ${p.alive ? 'üë§' : 'üíÄ'}</span>`;
                
                if (p.alive && p.id !== socket.id) {
                    const btn = document.createElement('button');
                    if (data.state === "night" && myRole === "Vampir") {
                        btn.innerText = "Saldƒ±r"; btn.className = "btn-kill";
                        btn.onclick = () => socket.emit('vampireAction', p.id);
                        card.appendChild(btn);
                    } else if (data.state === "night" && myRole === "Doktor") {
                        btn.innerText = "Koru"; btn.className = "btn-heal";
                        btn.onclick = () => socket.emit('doctorAction', p.id);
                        card.appendChild(btn);
                    } else if (data.state === "day") {
                        btn.innerText = "Oyla"; btn.className = "btn-vote";
                        btn.onclick = () => socket.emit('castVote', p.id);
                        card.appendChild(btn);
                    }
                }
                list.appendChild(card);
            });
        });

        socket.on('announcement', (m) => alert(m));
        socket.on('updatePlayerList', (players) => {
            if(myRole === "") {
                const list = document.getElementById('player-list');
                list.innerHTML = players.map(p => `<div class="player-card"><span>${p.name} üë§</span></div>`).join('');
            }
        });
    </script>
</body>
</html>