<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Vampir K√∂yl√º: Fix</title>
    <style>
        :root { --primary: #4ecca3; --danger: #ff4b5c; --bg: #1a1c2c; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; }
        #app { display: grid; grid-template-columns: 280px 1fr 280px; height: 100vh; padding: 10px; gap: 10px; box-sizing: border-box; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .scroll { overflow-y: auto; flex: 1; }
        .p-card { background: #2f357d; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .dead { opacity: 0.3; filter: grayscale(1); }
        button { background: var(--primary); border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .admin-btn { background: #f9d423; color: black; margin-top: 5px; }
        #chat { font-size: 13px; border-top: 1px solid #444; padding-top: 10px; }
    </style>
</head>
<body>

    <div id="setup" style="position:fixed; width:100%; height:100%; z-index:100; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1>üßõ‚Äç‚ôÇÔ∏è Vampir K√∂yl√º</h1>
        <input type="text" id="nameInp" placeholder="Adƒ±nƒ±z..." style="padding:15px; width:250px;">
        <br>
        <button onclick="join()" style="padding:15px 50px;">OYUNA Gƒ∞R</button>
    </div>

    <div id="app">
        <div class="panel">
            <h3>K√∂y Halkƒ±</h3>
            <div id="player-list" class="scroll"></div>
            <hr>
            <button class="admin-btn" onclick="socket.emit('adminResetGame')">‚ö†Ô∏è OYUNU SIFIRLA (RESET)</button>
        </div>

        <div class="panel">
            <div id="status" style="text-align:center; font-weight:bold; color:var(--primary); font-size: 1.2rem;">Lobi...</div>
            <div id="timer" style="text-align:center; font-size:2rem; color:gold;"></div>
            <div id="chat" class="scroll"></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="chatInp" style="flex:1; padding:10px; background:#222; border:1px solid #444; color:white;" placeholder="Mesaj...">
                <button onclick="sendMsg()">G√ñNDER</button>
            </div>
            <button id="startBtn" onclick="socket.emit('startGame')" style="margin-top:10px; width:100%; font-size:1.1rem;">OYUNU BA≈ûLAT</button>
            <button id="finishNightBtn" onclick="socket.emit('finishNight')" style="display:none; margin-top:5px; background:orange; width:100%;">GECEYƒ∞ Bƒ∞Tƒ∞R</button>
        </div>

        <div class="panel">
            <h3 id="my-role">Rol: ?</h3>
            <hr>
            <h4>G√∂revlerim</h4>
            <div id="task-list" class="scroll"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = "";

        function join() {
            const n = document.getElementById('nameInp').value;
            if(n) { socket.emit('joinGame', n); document.getElementById('setup').style.display='none'; }
        }

        function sendMsg() {
            const i = document.getElementById('chatInp');
            if(i.value) { socket.emit('sendMessage', {text: i.value}); i.value=""; }
        }

        socket.on('assignRole', data => {
            myRole = data.role;
            document.getElementById('my-role').innerText = "ROL√úN: " + myRole;
            document.getElementById('my-role').style.color = (myRole === 'Vampir') ? '#ff4b5c' : '#4ecca3';
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('finishNightBtn').style.display = 'block';
            
            const tList = document.getElementById('task-list');
            tList.innerHTML = "";
            data.tasks.forEach(t => {
                tList.innerHTML += `<div style="background:#3d445e; padding:8px; margin-bottom:5px; border-radius:5px; font-size:0.9rem;">üìç ${t}</div>`;
            });
        });

        socket.on('gameUpdate', data => {
            document.getElementById('status').innerText = data.message;
            const pList = document.getElementById('player-list');
            pList.innerHTML = "";
            data.players.forEach(p => {
                const div = document.createElement('div');
                div.className = `p-card ${p.alive ? '' : 'dead'}`;
                div.innerHTML = `<strong>${p.name}</strong>`;
                
                if(p.alive && p.id !== socket.id) {
                    const btn = document.createElement('button');
                    if(data.state === 'night') {
                        if(myRole === 'Vampir') { btn.innerText="SALDIR"; btn.onclick=()=>socket.emit('nightAction',{targetId:p.id}); div.appendChild(btn); }
                        if(myRole === 'Doktor') { btn.innerText="KORU"; btn.onclick=()=>socket.emit('nightAction',{targetId:p.id}); div.appendChild(btn); }
                        if(myRole === 'Kahin') { btn.innerText="BAK"; btn.onclick=()=>socket.emit('nightAction',{targetId:p.id}); div.appendChild(btn); }
                    } else if(data.state === 'day') {
                        btn.innerText="OYLA";
                        btn.onclick=()=> {
                            socket.emit('castVote', p.id);
                            btn.innerText = "OY VERƒ∞LDƒ∞";
                            btn.disabled = true;
                        };
                        div.appendChild(btn);
                    }
                }
                pList.appendChild(div);
            });
        });

        socket.on('receiveMessage', d => {
            const c = document.getElementById('chat');
            c.innerHTML += `<div><b>${d.name}:</b> ${d.text}</div>`;
            c.scrollTop = c.scrollHeight;
        });

        socket.on('timerUpdate', t => { document.getElementById('timer').innerText = t > 0 ? t : ""; });
        socket.on('announcement', m => alert(m));
        socket.on('gameOver', d => alert("OYUN Bƒ∞TTƒ∞: " + d.winner));
        socket.on('reload', () => location.reload()); // Admin reset atƒ±nca herkesi yeniler
        document.getElementById('chatInp').addEventListener('keypress', e => { if(e.key === 'Enter') sendMsg(); });
    </script>
</body>
</html>